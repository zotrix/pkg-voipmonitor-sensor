.\" DO NOT MODIFY THIS FILE!  It was generated by help2man 1.40.10.
.TH VOIPMONITOR "1" "November 2012" "voipmonitor version 5.31" "User Commands"
.SH NAME
voipmonitor \- Sniffer manual
.SH SYNOPSIS
.B voipmonitor
[\fI--config-file /etc/voipmonitor.conf\fR] [\fI-kncUSRAWG\fR] [\fI-i <interface>\fR] [\fI-f <pcap filter>\fR]
.SH DESCRIPTION
voipmonitor version 5.31
.IP
[\-r <file>] [\-d <pcap dump directory>] [\-v level] [\-h <mysql server>] [\-O <mysql_port>] [\-b <mysql database]
[\-u <mysql username>] [\-p <mysql password>] [\-f <pcap filter>] [\-\-rtp\-firstleg] [\-y]
[\-\-ring\-buffer <n>] [\-\-vm\-buffer <n>] [\-\-manager\-port <n>] [\-\-norecord\-header] [\-s, \fB\-\-id\-sensor\fR <num>]
.IP
[\-\-rtp\-threads <n>] [\-\-rtpthread\-buffer] <n>]
.HP
\fB\-m\fR, \fB\-\-rtp\-timeout\fR <n>
.IP
rtptimeout is important value which specifies how much seconds from the last SIP packet or RTP packet is call closed
and writen to database. It means that if you need to monitor ONLY SIP you have to set this to at leat 2 hours = 7200
assuming your calls is not longer than 2 hours. Take in mind that seting this to very large value will cause to keep
call in memory in case the call lost BYE and can consume all memory and slows down the sniffer \- so do not set it to
very high numbers. Default is 300 seconds.
.HP
\fB\-e\fR, \fB\-\-rtp\-threads\fR <n>
.IP
number of threads to process RTP packets. If not specified it will be number of available CPUs.
If equel to zero RTP threading will be turned off. Each thread allocates default 20MB for buffers. This
buffer can be controlled with \fB\-\-rtpthread\-buffer\fR
For < 150 concurrent calls you can turn it off
.HP
\fB\-E\fR, \fB\-\-rtpthread\-buffer\fR <n>
.IP
size of rtp thread ring buffer in MB. Default is 20MB per thread
.HP
\fB\-S\fR, \fB\-\-save\-sip\fR
.IP
save SIP packets to pcap file. Default is disabled.
.HP
\fB\-s\fR, \fB\-\-id\-sensor\fR <num>
.IP
if set the number is saved to sql cdr.id_sensor
.HP
\fB\-R\fR, \fB\-\-save\-rtp\fR
.IP
save RTP packets to pcap file. Default is disabled. Whan enabled RTCP packets will be saved too.
.HP
\fB\-o\fR, \fB\-\-skip\-rtppayload\fR
.IP
skip RTP payload and save only RTP headers.
.HP
\fB\-D\fR, \fB\-\-save\-udptl\fR
.IP
save UDPTL packets (T.38). If savertp = yes the UDPTL packets are saved automatically. If savertp = no
and you want to save only udptl packets enable saveudptl = yes and savertp = no
.HP
\fB\-\-save\-rtcp\fR
.IP
save RTCP packets to pcap file. You can enable SIP signalization + only RTCP packets and not RTP packets.
.HP
\fB\-\-sip\-register\fR
.IP
save SIP register requests to cdr.register table and to pcap file.
.HP
\fB\-\-norecord\-header\fR
.IP
if any of SIP message during the call contains header X\-VoipMonitor\-norecord call will be not converted to wav and pcap file will be deleted.
.HP
\fB\-\-rtp\-firstleg\fR
.IP
this is important option if voipmonitor is sniffing on SIP proxy and see both RTP leg of CALL.
in that case use this option. It will analyze RTP only for the first LEG and not each 4 RTP
streams which will confuse voipmonitor. Drawback of this switch is that voipmonitor will analyze
SDP only for SIP packets which have the same IP and port of the first INVITE source IP
and port. It means it will not work in case where phone sends INVITE from a.b.c.d:1024 and
SIP proxy replies to a.b.c.d:5060. If you have better idea how to solve this problem better
please contact support@voipmonitor.org
.HP
\fB\-L\fR, \fB\-\-deduplicate\fR
.IP
duplicate check do md5 sum for each packet and if md5 is same as previous packet it will discard it
WARNING: md5 is expensive function (slows voipmonitor 3 times) so use it only if you have enough CPU or
for pcap conversion only
.HP
\fB\-W\fR, \fB\-\-save\-audio\fR
.IP
save RTP packets and covert it to one WAV file. Default is disabled.
.HP
\fB\-\-audio\-format\fR <wav|ogg>
.IP
Save to WAV or OGG audio format. Default is WAV.
.HP
\fB\-\-sip\-messages\fR
.IP
save REGISTER messages
.HP
\fB\-\-ring\-buffer\fR
.IP
Set ring buffer in MB (feature of newer >= 2.6.31 kernels and libpcap >= 1.0.0). If you see voipmonitor dropping
packets in syslog upgrade to newer kernel and increase \fB\-\-ring\-buffer\fR to higher MB or enable \fB\-\-pcap\-thread\fR.
Ring\-buffer is between kernel and pcap library. The most top reason why voipmonitor drops packets is waiting for I/O
operations or it consumes 100% CPU.
.HP
\fB\-\-vm\-buffer\fR
.IP
vmbuffer is user space buffers in MB which is used in case there is more then 1 CPU and the sniffer
run two threads \- one for reading data from libpcap and writing to vmbuffer and second reads data from
vmbuffer and process it. For very high network loads set this to very high number. Or in case the system
is droping packets (which is logged to syslog) increase this value.
default is 20 MB
.HP
\fB\-\-pcap\-thread\fR
.IP
Read packet from kernel in one thread and process packet in another thread. Packets are copied to non\-blocking queue
use this option if voipmonitor is dropping packets (you can see it in syslog). You can Use this option with \fB\-\-ring\-buffer\fR
.HP
\fB\-c\fR, \fB\-\-no\-cdr\fR
.IP
do no save CDR to MySQL database.
.HP
\fB\-A\fR, \fB\-\-save\-raw\fR
.IP
save RTP payload to RAW format. Default is disabled.
.HP
\fB\-\-rtp\-nosig\fR
.IP
analyze calls based on RTP only \- handy if you want extract call which does not have signalization (or H323 calls which voipmonitor does not know yet).
.HP
\fB\-G\fR, \fB\-\-save\-graph\fR=\fI[gzip\fR|plain]
.IP
save GRAPH data to graph file. Default is disabled. Default format is plain. For gzip format use \fB\-\-save\-graph\fR=\fIgzip\fR
.HP
\fB\-r\fR <file>
.IP
read packets from <file>.
.HP
\fB\-f\fR <filter>
.IP
Pcap filter. If you will use only UDP, put here udp. Warning: If you set protocol to 'udp' pcap discards VLAN packets. Maximum size is 2040 chars
.HP
\fB\-C\fR, \fB\-\-cachedir\fR <dir>
.IP
store pcap file to <dir> and move it after call ends to spool directory. Moving all files are guaranteed to be serialized which
solves slow random write I/O on magnetic or other media. Typical cache directory is /dev/shm/voipmonitor which is in RAM and grows
automatically or /mnt/ssd/voipmonitor which is mounted to SSD disk or some very fast SAS/SATA disk where spool can be network storage
or raid5 etc. Wav files are not implemented yet
.HP
\fB\-d\fR <dir>
.IP
where to store pcap files \- default /var/spool/voipmonitor
.TP
\fB\-k\fR
Do not fork or detach from controlling terminal.
.TP
\fB\-n\fR
Do not put the interface into promiscuous mode.
.TP
\fB\-U\fR
make .pcap files writing ??????packet\-buffered?????? \- more slow method,
.IP
but you can use partialy writen file anytime, it will be consistent.
.HP
\fB\-h\fR <hostname>, \fB\-\-mysql\-server=\fR<hostname>
.IP
mysql server \- default localhost
.HP
\fB\-O\fR <port>, \fB\-\-mysql\-port=\fR<port>
.IP
mysql server \- default localhost
.HP
\fB\-b\fR <database>, \fB\-\-mysql\-database\fR
.IP
mysql database, default voipmonitor
.HP
\fB\-t\fR <table>, \fB\-\-mysql\-table=\fR<table>
.IP
mysql table, default cdr
.HP
\fB\-u\fR <username>, \fB\-\-mysql\-username=\fR<username>
.IP
mysql username, default root
.HP
\fB\-p\fR <password>, \fB\-\-mysql\-password=\fR<password>
.IP
mysql password, default is empty
.HP
\fB\-P\fR <pid file>, \fB\-\-pid\-file=\fR<pid file>
.IP
pid file, default /var/run/voipmonitor.pid
.HP
\fB\-\-manager\-port\fR <port number>
.IP
to which TCP port should manager interface bind. Defaults to 5029.
.TP
\fB\-y\fR
listen to SIP protocol on ports 5060 \- 5099
.HP
\fB\-v\fR <level number>
.IP
set verbosity level (higher number is more verbose).
.PP
You have to provide <\-i interfce> or <\-r pcap_file> or set interface in configuration file
.PP
Usage: voipmonitor [\-\-config\-file /etc/voipmonitor.conf] [\-kncUSRAWG] [\-i <interface>] [\-f <pcap filter>]
.IP
[\-r <file>] [\-d <pcap dump directory>] [\-v level] [\-h <mysql server>] [\-O <mysql_port>] [\-b <mysql database]
[\-u <mysql username>] [\-p <mysql password>] [\-f <pcap filter>] [\-\-rtp\-firstleg] [\-y]
[\-\-ring\-buffer <n>] [\-\-vm\-buffer <n>] [\-\-manager\-port <n>] [\-\-norecord\-header] [\-s, \fB\-\-id\-sensor\fR <num>]
.IP
[\-\-rtp\-threads <n>] [\-\-rtpthread\-buffer] <n>]
.HP
\fB\-m\fR, \fB\-\-rtp\-timeout\fR <n>
.IP
rtptimeout is important value which specifies how much seconds from the last SIP packet or RTP packet is call closed
and writen to database. It means that if you need to monitor ONLY SIP you have to set this to at leat 2 hours = 7200
assuming your calls is not longer than 2 hours. Take in mind that seting this to very large value will cause to keep
call in memory in case the call lost BYE and can consume all memory and slows down the sniffer \- so do not set it to
very high numbers. Default is 300 seconds.
.HP
\fB\-e\fR, \fB\-\-rtp\-threads\fR <n>
.IP
number of threads to process RTP packets. If not specified it will be number of available CPUs.
If equel to zero RTP threading will be turned off. Each thread allocates default 20MB for buffers. This
buffer can be controlled with \fB\-\-rtpthread\-buffer\fR
For < 150 concurrent calls you can turn it off
.HP
\fB\-E\fR, \fB\-\-rtpthread\-buffer\fR <n>
.IP
size of rtp thread ring buffer in MB. Default is 20MB per thread
.HP
\fB\-S\fR, \fB\-\-save\-sip\fR
.IP
save SIP packets to pcap file. Default is disabled.
.HP
\fB\-s\fR, \fB\-\-id\-sensor\fR <num>
.IP
if set the number is saved to sql cdr.id_sensor
.HP
\fB\-R\fR, \fB\-\-save\-rtp\fR
.IP
save RTP packets to pcap file. Default is disabled. Whan enabled RTCP packets will be saved too.
.HP
\fB\-o\fR, \fB\-\-skip\-rtppayload\fR
.IP
skip RTP payload and save only RTP headers.
.HP
\fB\-D\fR, \fB\-\-save\-udptl\fR
.IP
save UDPTL packets (T.38). If savertp = yes the UDPTL packets are saved automatically. If savertp = no
and you want to save only udptl packets enable saveudptl = yes and savertp = no
.HP
\fB\-\-save\-rtcp\fR
.IP
save RTCP packets to pcap file. You can enable SIP signalization + only RTCP packets and not RTP packets.
.HP
\fB\-\-sip\-register\fR
.IP
save SIP register requests to cdr.register table and to pcap file.
.HP
\fB\-\-norecord\-header\fR
.IP
if any of SIP message during the call contains header X\-VoipMonitor\-norecord call will be not converted to wav and pcap file will be deleted.
.HP
\fB\-\-rtp\-firstleg\fR
.IP
this is important option if voipmonitor is sniffing on SIP proxy and see both RTP leg of CALL.
in that case use this option. It will analyze RTP only for the first LEG and not each 4 RTP
streams which will confuse voipmonitor. Drawback of this switch is that voipmonitor will analyze
SDP only for SIP packets which have the same IP and port of the first INVITE source IP
and port. It means it will not work in case where phone sends INVITE from a.b.c.d:1024 and
SIP proxy replies to a.b.c.d:5060. If you have better idea how to solve this problem better
please contact support@voipmonitor.org
.HP
\fB\-L\fR, \fB\-\-deduplicate\fR
.IP
duplicate check do md5 sum for each packet and if md5 is same as previous packet it will discard it
WARNING: md5 is expensive function (slows voipmonitor 3 times) so use it only if you have enough CPU or
for pcap conversion only
.HP
\fB\-W\fR, \fB\-\-save\-audio\fR
.IP
save RTP packets and covert it to one WAV file. Default is disabled.
.HP
\fB\-\-audio\-format\fR <wav|ogg>
.IP
Save to WAV or OGG audio format. Default is WAV.
.HP
\fB\-\-sip\-messages\fR
.IP
save REGISTER messages
.HP
\fB\-\-ring\-buffer\fR
.IP
Set ring buffer in MB (feature of newer >= 2.6.31 kernels and libpcap >= 1.0.0). If you see voipmonitor dropping
packets in syslog upgrade to newer kernel and increase \fB\-\-ring\-buffer\fR to higher MB or enable \fB\-\-pcap\-thread\fR.
Ring\-buffer is between kernel and pcap library. The most top reason why voipmonitor drops packets is waiting for I/O
operations or it consumes 100% CPU.
.HP
\fB\-\-vm\-buffer\fR
.IP
vmbuffer is user space buffers in MB which is used in case there is more then 1 CPU and the sniffer
run two threads \- one for reading data from libpcap and writing to vmbuffer and second reads data from
vmbuffer and process it. For very high network loads set this to very high number. Or in case the system
is droping packets (which is logged to syslog) increase this value.
default is 20 MB
.HP
\fB\-\-pcap\-thread\fR
.IP
Read packet from kernel in one thread and process packet in another thread. Packets are copied to non\-blocking queue
use this option if voipmonitor is dropping packets (you can see it in syslog). You can Use this option with \fB\-\-ring\-buffer\fR
.HP
\fB\-c\fR, \fB\-\-no\-cdr\fR
.IP
do no save CDR to MySQL database.
.HP
\fB\-A\fR, \fB\-\-save\-raw\fR
.IP
save RTP payload to RAW format. Default is disabled.
.HP
\fB\-\-rtp\-nosig\fR
.IP
analyze calls based on RTP only \- handy if you want extract call which does not have signalization (or H323 calls which voipmonitor does not know yet).
.HP
\fB\-G\fR, \fB\-\-save\-graph\fR=\fI[gzip\fR|plain]
.IP
save GRAPH data to graph file. Default is disabled. Default format is plain. For gzip format use \fB\-\-save\-graph\fR=\fIgzip\fR
.HP
\fB\-r\fR <file>
.IP
read packets from <file>.
.HP
\fB\-f\fR <filter>
.IP
Pcap filter. If you will use only UDP, put here udp. Warning: If you set protocol to 'udp' pcap discards VLAN packets. Maximum size is 2040 chars
.HP
\fB\-C\fR, \fB\-\-cachedir\fR <dir>
.IP
store pcap file to <dir> and move it after call ends to spool directory. Moving all files are guaranteed to be serialized which
solves slow random write I/O on magnetic or other media. Typical cache directory is /dev/shm/voipmonitor which is in RAM and grows
automatically or /mnt/ssd/voipmonitor which is mounted to SSD disk or some very fast SAS/SATA disk where spool can be network storage
or raid5 etc. Wav files are not implemented yet
.HP
\fB\-d\fR <dir>
.IP
where to store pcap files \- default /var/spool/voipmonitor
.TP
\fB\-k\fR
Do not fork or detach from controlling terminal.
.TP
\fB\-n\fR
Do not put the interface into promiscuous mode.
.TP
\fB\-U\fR
make .pcap files writing ??????packet\-buffered?????? \- more slow method,
.IP
but you can use partialy writen file anytime, it will be consistent.
.HP
\fB\-h\fR <hostname>, \fB\-\-mysql\-server=\fR<hostname>
.IP
mysql server \- default localhost
.HP
\fB\-O\fR <port>, \fB\-\-mysql\-port=\fR<port>
.IP
mysql server \- default localhost
.HP
\fB\-b\fR <database>, \fB\-\-mysql\-database\fR
.IP
mysql database, default voipmonitor
.HP
\fB\-t\fR <table>, \fB\-\-mysql\-table=\fR<table>
.IP
mysql table, default cdr
.HP
\fB\-u\fR <username>, \fB\-\-mysql\-username=\fR<username>
.IP
mysql username, default root
.HP
\fB\-p\fR <password>, \fB\-\-mysql\-password=\fR<password>
.IP
mysql password, default is empty
.HP
\fB\-P\fR <pid file>, \fB\-\-pid\-file=\fR<pid file>
.IP
pid file, default /var/run/voipmonitor.pid
.HP
\fB\-\-manager\-port\fR <port number>
.IP
to which TCP port should manager interface bind. Defaults to 5029.
.TP
\fB\-y\fR
listen to SIP protocol on ports 5060 \- 5099
.HP
\fB\-v\fR <level number>
.IP
set verbosity level (higher number is more verbose).
.PP
You have to provide <\-i interfce> or <\-r pcap_file> or set interface in configuration file
.SH "SEE ALSO"
The full documentation for
.B voipmonitor
is maintained as a Texinfo manual.  If the
.B info
and
.B voipmonitor
programs are properly installed at your site, the command
.IP
.B info voipmonitor
.PP
should give you access to the complete manual.
